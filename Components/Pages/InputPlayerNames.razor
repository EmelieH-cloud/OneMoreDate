@page "/inputPlayerNames"
@using OneMoreDate.Components.Reusable
@using OneMoreDate.Managers
@using OneMoreDate.Models
@inject NavigationManager navigationManager

<style>
   
    .custom-color
    {
        border-color: black;
    }

    .my-border
    {
        border: 1px solid black;
       
    }

    .input-container
    {
        position: fixed;
        bottom: 0%; 
        width: 100%;
        background-color: gray;
    
      
    }
</style>




<GoBackBtn BackUrl="menu" />

<div class="outer-playernames-container">

    <div class="rounded animate__animated animate__slideInLeft ">

      
        <div class="input-container d-flex border border-danger vw-100 justiify-content-center align-items-center">
            <input @bind="InputValue" placeholder="Name" class="form-control custom-color" disabled="@inputIsDone" @ref="playerNameInput" />
            <button @onclick="AddPlayers" class="button-29 fw-bold m-1 ">+</button>
            <button @onclick="AddActivePlayers" class="button-29 m-1" disabled="@disableDoneBtn">></button>
        </div>
        @foreach (var name in Names)
        {
            <div class="name-container bg-light my-border rounded">
                <p class="p-2 name-p small">
                    @name
                </p>
                <button class="fw-bolder fs-1 button-29 custom-btn-height" @onclick="() => RemovePlayer(name)">-</button>
            </div>
        }

    </div>
</div>

@code {
    private List<Player>? players = new List<Player>();

    private bool inputIsDone = false;
    private bool disableDoneBtn = true;
    public string InputValue { get; set; }
    public List<string> Names { get; set; } = new List<string>();
    private ElementReference playerNameInput;

    private void AddPlayers()
    {

        if (!string.IsNullOrEmpty(InputValue))
        {
            Names.Add(InputValue);
            InputValue = "";

        }

        if (Names.Count>=1)
        {
            disableDoneBtn = false;
        }
        if(PlayerManager.Players.Count >=10)
        {
            inputIsDone = true;
            StateHasChanged();

        }

        else
        {
            // Sätt fokus tillbaka till input-elementet efter att en spelare har lagts till
            _ = FocusInputAsync();
        }


    }

    private void RemovePlayer(string name)
    {
        Names.Remove(name);
        if (Names.Count ==10)
        {
            inputIsDone = false;
            disableDoneBtn = true;
        }
        StateHasChanged();
        // Sätt fokus tillbaka till input-elementet efter att en spelare har tagits bort
        _ = FocusInputAsync();
    }

    private void AddActivePlayers()
    {
        PlayerManager.Players.Clear();
        PlayerManager.AddActivePlayers(Names);
        Names.Clear();
        navigationManager.NavigateTo("/deck");
    }

    protected override void OnInitialized()
    {


        Names.Clear();
        players = PlayerManager.Players;
        if (players!= null)
        {
            foreach (Player p in players)
            {
                Names.Add(p.Name);
            }
        }

        // Så att done-button fungerar även om man kommer tillbaka till sidan.
        if (players!= null && players.Count>=1)
        {
            disableDoneBtn = false;
        }
    }


    private async Task FocusInputAsync()
    {
        await Task.Delay(1); // Vänta en kort stund för att säkerställa att rendering är klar
        await playerNameInput.FocusAsync();
    }
}
